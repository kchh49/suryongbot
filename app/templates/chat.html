<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>입시도우미 수룡이</title>
    <link rel="stylesheet" href="/static/assets/style_chat.css" />
  </head>
  <body class="chat-body-bg">
    <!-- 상단 바 -->
    <div class="chat-header">
      <div class="logo-group">
        <img src="/static/assets/logo.png" alt="성신여대 로고" class="logo-img" />
      </div>
      <div class="header-buttons">
        <div class="dot green"></div>
        <div class="dot yellow"></div>
        <div class="dot red"></div>
        <div class="header-icon"></div>
        <div class="header-menu"></div>
      </div>
    </div>

    <!-- 채팅 내용 -->
    <div class="chat-container" id="chatBody">
      <!-- 채팅 말풍선은 JS로 추가됨 -->
    </div>

    <!-- 입력창 -->
    <div class="input-area">
      <textarea id="questionInput" placeholder="질문을 입력해 주세요..."></textarea>
      <button onclick="sendMessage()" class="send-btn">&#x2191;</button>
    </div>

    <script>
  async function sendMessage() {
    const input = document.getElementById("questionInput");
    const text = input.value.trim();
    if (!text) return;

    const chatBody = document.getElementById("chatBody");

    // ① 사용자 말풍선
    const userBubble = document.createElement("div");
    userBubble.className = "chat-bubble user";
    userBubble.textContent = text;
    chatBody.appendChild(userBubble);
    input.value = "";
    chatBody.scrollTop = chatBody.scrollHeight;

    // ② "입력중입니다..." 수룡이 말풍선
    const botContainer = document.createElement("div");
    botContainer.className = "bot-container";

    const suryongImg = document.createElement("img");
    suryongImg.src = "/static/assets/suryong.png";
    suryongImg.alt = "수룡이";
    suryongImg.className = "suryong-profile";

    const botBubble = document.createElement("div");
    botBubble.className = "chat-bubble bot";
    botBubble.textContent = "입력중입니다..."; // 초기 로딩 메시지

    botContainer.appendChild(suryongImg);
    botContainer.appendChild(botBubble);
    chatBody.appendChild(botContainer);
    chatBody.scrollTop = chatBody.scrollHeight;

    try {
      const res = await fetch("/query", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ query: text })
      });

      const data = await res.json();

      // ③ GPT 응답으로 메시지 업데이트
      botBubble.textContent = data.answer || "답변을 가져오는 데 문제가 생겼어요.";
      chatBody.scrollTop = chatBody.scrollHeight;

    } catch (error) {
      botBubble.textContent = "⚠️ 서버와 연결할 수 없어요.";
      chatBody.scrollTop = chatBody.scrollHeight;
    }
  }
</script>

    
  </body>
</html>
